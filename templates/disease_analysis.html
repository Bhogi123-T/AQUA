{% extends "layout.html" %}

{% block content %}
<div class="app-card">
    <span class="app-emoji">ğŸ§ª</span>
    <h2 style="font-size: 3rem; font-weight: 900; margin-bottom: 1rem;">{{ trans['disease_title'] | safe }}</h2>
    <p style="color: var(--text-muted); margin-bottom: 3.5rem; font-size: 1.2rem;">{{ trans['feat_disease_desc'] }}</p>

    <div
        style="background: rgba(0, 210, 255, 0.05); padding: 1.5rem; border-radius: 1.5rem; margin-bottom: 2.5rem; border: 1px dashed var(--primary); display: flex; align-items: center; justify-content: space-between;">
        <div style="text-align: left;">
            <p style="margin:0; font-weight: 800; color: var(--primary);">ğŸ“¡ LIVE SENSOR DATA AVAILABLE</p>
            <p style="margin:0; font-size: 0.8rem; color: var(--text-muted);">Auto-fill form with real-time telemetry
            </p>
        </div>
        <button type="button" onclick="syncWithSensors()" class="app-btn-small"
            style="background: var(--primary); color: #000; padding: 10px 20px; border-radius: 1rem; border:none; font-weight: 900; cursor: pointer; transition: all 0.3s;">âš¡
            SYNC NOW</button>
    </div>

    <form action="/predict_disease" method="POST" class="app-form" id="disease-form">
        <div class="app-input-group">
            <span class="app-label">{{ trans['water_temp'] }} (Â°C)</span>
            <input type="number" step="0.1" name="temp" id="input-temp" class="app-input" placeholder="e.g. 28.5"
                required>
        </div>

        <div class="app-input-group">
            <span class="app-label">pH {{ trans['level'] }}</span>
            <input type="number" step="0.01" name="ph" id="input-ph" class="app-input" placeholder="e.g. 7.2" required>
        </div>

        <div class="app-input-group">
            <span class="app-label">{{ trans['do'] }} (mg/L)</span>
            <input type="number" step="0.1" name="do" id="input-do" class="app-input" placeholder="e.g. 6.0" required>
        </div>

        <div class="app-input-group">
            <span class="app-label">{{ trans['salinity'] }} (ppt)</span>
            <input type="number" step="0.1" name="salinity" id="input-salinity" class="app-input" placeholder="e.g. 15"
                required>
        </div>

        <div class="app-input-group">
            <span class="app-label">{{ trans['turbidity'] }} (NTU)</span>
            <input type="number" step="0.1" name="turbidity" id="input-turbidity" class="app-input"
                placeholder="e.g. 30" required>
        </div>

        <button class="app-btn-large">ğŸ” {{ trans['btn_risk'] }}</button>
    </form>

    <script>
        function syncWithSensors() {
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "â³ SYNCING...";
            btn.disabled = true;

            fetch('/api/realtime')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('input-temp').value = data.temp;
                    document.getElementById('input-ph').value = data.ph;
                    document.getElementById('input-do').value = data.do;
                    document.getElementById('input-salinity').value = data.salinity;
                    document.getElementById('input-turbidity').value = data.turbidity;

                    btn.innerText = "âœ… SYNCED";
                    btn.style.background = "#00ff88";
                    setTimeout(() => {
                        btn.innerText = originalText;
                        btn.style.background = "var(--primary)";
                        btn.disabled = false;
                    }, 2000);
                })
                .catch(err => {
                    alert("Sensor sync failed. Please enter manually.");
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
        }
    </script>

    <div style="margin-top: 4rem;">
        <a href="/farmer?lang={{ lang }}"
            style="color: var(--text-muted); text-decoration: none; font-weight: 800; font-size: 1.4rem; transition: color 0.3s;">
            ğŸ”™ {{ trans['back'] }}
        </a>
    </div>
</div>
{% endblock %}